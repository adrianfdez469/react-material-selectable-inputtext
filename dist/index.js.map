{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["// libs\r\nimport * as React from 'react';\r\nimport {\r\n  TextField,\r\n  InputAdornment,\r\n  IconButton,\r\n  Popper,\r\n  Grow,\r\n  Paper,\r\n  ClickAwayListener,\r\n  MenuList,\r\n  MenuItem,\r\n  TextFieldProps\r\n} from '@material-ui/core';\r\nimport AddIcon from '@material-ui/icons/Add';\r\n\r\n// constants\r\nconst ITEM_HEIGHT = 48;\r\n\r\n// helpers \r\nconst escapeRegExp = (string:string) => string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n\r\n// Types\r\nexport type MenuItemType = { id: string|number|null, text: string }; \r\nexport type PropTypes = {\r\n  textFieldProps?: TextFieldProps,\r\n  optionsList: MenuItemType[],\r\n  excludedOptions: MenuItemType[],\r\n  onAdd: (data: MenuItemType) => void\r\n}\r\n\r\n\r\nconst InputTextSelect:React.FC<PropTypes> = (props) => {\r\n  // constants\r\n  const { onAdd, optionsList, excludedOptions, textFieldProps } = props;\r\n  // hooks\r\n  const [inputData, setInputData] = React.useState<MenuItemType|null>(null);\r\n  const [open, setOpen] = React.useState(false);\r\n  const [menuFocused, setMenuFocused] = React.useState(false);\r\n  const textFieldRef = React.useRef<HTMLInputElement>(null);\r\n  const anchorRef = React.useRef(null);\r\n\r\n  // handlers\r\n  const changeInputHandler = (event:React.ChangeEvent<HTMLInputElement>) => {\r\n    if (event.target.value === '') {\r\n      setInputData(null);\r\n    } else {\r\n      if (!open) {\r\n        setOpen(true);\r\n      }\r\n      setInputData({ id: null, text: event.target.value });\r\n    }\r\n  };\r\n  const selectMenuItemHandler = (lang: MenuItemType) => {\r\n    setInputData(lang);\r\n    textFieldRef.current?.focus();\r\n    setOpen(false);\r\n    setMenuFocused(false);\r\n  };\r\n\r\n  const addHandler = () => {\r\n    if (inputData) {\r\n      // Search for a item that already exist on the full posibles items array\r\n      const index = optionsList.findIndex(\r\n        (optList) => optList.text.toLowerCase().trim() === inputData.text.toLowerCase().trim()\r\n      );\r\n      if (index > -1) {\r\n        onAdd(optionsList[index]);\r\n      } else {\r\n        onAdd(inputData);\r\n      }\r\n    }\r\n    setInputData(null);\r\n    setOpen(false);\r\n  };\r\n  const onPressKeyHandler = (event: React.KeyboardEvent<HTMLDivElement>) => {\r\n    if (event.key === 'Enter') {\r\n      addHandler();\r\n    } else if (event.key === 'ArrowDown') {\r\n      setMenuFocused(true);\r\n    }\r\n  };\r\n  const onMenuPressKeyHandler = (event:React.KeyboardEvent<HTMLLIElement>) => {\r\n    if (event.key === 'ArrowUp') {\r\n      event.stopPropagation();\r\n      setMenuFocused(false);\r\n      textFieldRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // helpers\r\n  const menuItems = optionsList\r\n    .filter(\r\n      (optList) =>\r\n        excludedOptions.findIndex(\r\n          (selectedPL) => optList.text.toLowerCase().trim() === selectedPL.text.toLowerCase().trim()\r\n        ) === -1\r\n    )\r\n    .filter((optList) => {\r\n      if (!inputData) return false;\r\n      const find = inputData.text.toLowerCase().trim();\r\n      return !optList.text.toLowerCase().trim().search(escapeRegExp(find));\r\n    })\r\n    .map((optList, index) => {\r\n      if (index === 0) {\r\n        return (\r\n          <MenuItem\r\n            autoFocus={menuFocused}\r\n            key={optList.id}\r\n            onKeyDown={(event) => onMenuPressKeyHandler(event)}\r\n            onClick={() => selectMenuItemHandler(optList)}\r\n          >\r\n            {optList.text}\r\n          </MenuItem>\r\n        );\r\n      }\r\n      return (\r\n        <MenuItem key={optList.id} onClick={() => selectMenuItemHandler(optList)}>\r\n          {optList.text}\r\n        </MenuItem>\r\n      );\r\n    });\r\n\r\n  return (\r\n    <div>\r\n      <TextField\r\n        value={inputData && inputData.text ? inputData.text : ''}\r\n        onChange={(event: React.ChangeEvent<HTMLInputElement>) => changeInputHandler(event)}\r\n        ref={anchorRef}\r\n        onFocus={() => {\r\n          setTimeout(() => {\r\n            (textFieldRef.current as HTMLInputElement).selectionStart = 0;\r\n            (textFieldRef.current as HTMLInputElement).selectionEnd = 9999999;\r\n          }, 0);\r\n        }}\r\n        inputRef={textFieldRef}\r\n        onKeyUp={(event) => {\r\n          onPressKeyHandler(event);\r\n        }}\r\n        InputProps={\r\n           {\r\n            endAdornment: (\r\n              <InputAdornment position=\"end\">\r\n                <IconButton\r\n                  aria-label=\"toggle password visibility\"\r\n                  onClick={addHandler}\r\n                  onMouseDown={(event) => {\r\n                    event.preventDefault();\r\n                  }}\r\n                >\r\n                  <AddIcon />\r\n                </IconButton>\r\n              </InputAdornment>\r\n            ),\r\n          }\r\n        }\r\n        {...textFieldProps}\r\n      />\r\n      <Popper\r\n        open={open}\r\n        anchorEl={anchorRef.current}\r\n        role={undefined}\r\n        transition\r\n        disablePortal\r\n        style={{ zIndex: 999 }}\r\n      >\r\n        {({ TransitionProps, placement }) => (\r\n          <Grow\r\n            {...TransitionProps}\r\n            style={{ transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom' }}\r\n          >\r\n            <Paper\r\n              style={{\r\n                width: menuItems.length > 0 ? (anchorRef.current as unknown as HTMLInputElement).offsetWidth : 0,\r\n                maxHeight: ITEM_HEIGHT * 4.5,\r\n                overflow: 'auto',\r\n              }}\r\n            >\r\n              <ClickAwayListener onClickAway={() => {}}>\r\n                <MenuList id=\"menu-list-grow\">{menuItems}</MenuList>\r\n              </ClickAwayListener>\r\n            </Paper>\r\n          </Grow>\r\n        )}\r\n      </Popper>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InputTextSelect;\r\n"],"names":["React.useState","React.useRef","React.createElement","MenuItem","TextField","InputAdornment","IconButton","AddIcon","Popper","Grow","Paper","ClickAwayListener","MenuList"],"mappings":"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"}